// DEEP INVESTIGATION: Why custom app isn't appearing
System.debug('=== DEEP CUSTOM APP INVESTIGATION ===');

// 1. Check current user profile and permissions
User currentUser = [
    SELECT Id, Name, Email, Profile.Name, Profile.Id, UserType, IsActive
    FROM User 
    WHERE Id = :UserInfo.getUserId()
];

System.debug('üë§ USER DETAILS:');
System.debug('  ‚Ä¢ Name: ' + currentUser.Name);
System.debug('  ‚Ä¢ Email: ' + currentUser.Email);
System.debug('  ‚Ä¢ Profile: ' + currentUser.Profile.Name);
System.debug('  ‚Ä¢ Profile ID: ' + currentUser.Profile.Id);
System.debug('  ‚Ä¢ User Type: ' + currentUser.UserType);
System.debug('  ‚Ä¢ Active: ' + currentUser.IsActive);

// 2. Check all permission set assignments
List<PermissionSetAssignment> allPermSets = [
    SELECT PermissionSet.Name, PermissionSet.Label, PermissionSet.Type
    FROM PermissionSetAssignment 
    WHERE AssigneeId = :UserInfo.getUserId()
];

System.debug('üîê ALL PERMISSION SETS (' + allPermSets.size() + '):');
Boolean hasJobAppManager = false;
for (PermissionSetAssignment psa : allPermSets) {
    System.debug('  ‚Ä¢ ' + psa.PermissionSet.Label + ' (' + psa.PermissionSet.Name + ') - Type: ' + psa.PermissionSet.Type);
    if (psa.PermissionSet.Name == 'Job_Application_Manager') {
        hasJobAppManager = true;
    }
}

System.debug('‚úÖ Has Job_Application_Manager: ' + hasJobAppManager);

// 3. Check Lightning Experience
System.debug('‚ö° LIGHTNING EXPERIENCE CHECK:');
String uiTheme = UserInfo.getUiThemeDisplayed();
System.debug('  ‚Ä¢ UI Theme: ' + uiTheme);
System.debug('  ‚Ä¢ Is Lightning: ' + (uiTheme == 'Theme4d' ? 'YES ‚úÖ' : 'NO ‚ùå (This could be the issue!)'));

// 4. Check organization info
System.debug('üè¢ ORGANIZATION INFO:');
System.debug('  ‚Ä¢ Org ID: ' + UserInfo.getOrganizationId());
System.debug('  ‚Ä¢ Org Name: ' + UserInfo.getOrganizationName());

// 5. Test object access in detail
System.debug('üìä DETAILED OBJECT ACCESS CHECK:');
try {
    Schema.DescribeSObjectResult jobAppDescribe = Job_Application__c.SObjectType.getDescribe();
    System.debug('  ‚Ä¢ Object Label: ' + jobAppDescribe.getLabel());
    System.debug('  ‚Ä¢ Object API Name: ' + jobAppDescribe.getName());
    System.debug('  ‚Ä¢ Accessible: ' + jobAppDescribe.isAccessible());
    System.debug('  ‚Ä¢ Createable: ' + jobAppDescribe.isCreateable());
    System.debug('  ‚Ä¢ Custom: ' + jobAppDescribe.isCustom());
    System.debug('  ‚Ä¢ Deployable: ' + jobAppDescribe.isDeletable());
    
    // Try to query records
    List<Job_Application__c> records = [SELECT Id, Name, Company_Name__c FROM Job_Application__c LIMIT 3];
    System.debug('  ‚Ä¢ Records Found: ' + records.size());
    
} catch (Exception e) {
    System.debug('‚ùå Object Access Error: ' + e.getMessage());
}

// 6. Check tab access
System.debug('üìã TAB ACCESS CHECK:');
try {
    // This will tell us if the tab is accessible
    List<Schema.DescribeTabSetResult> tabSets = Schema.describeTabs();
    Boolean foundJobAppTab = false;
    
    for (Schema.DescribeTabSetResult tabSet : tabSets) {
        for (Schema.DescribeTabResult tab : tabSet.getTabs()) {
            if (tab.getSObjectName() == 'Job_Application__c') {
                foundJobAppTab = true;
                System.debug('  ‚Ä¢ Job Applications Tab Found: ‚úÖ');
                System.debug('  ‚Ä¢ Tab Label: ' + tab.getLabel());
                System.debug('  ‚Ä¢ Tab Available: ' + tab.isAvailable());
                break;
            }
        }
        if (foundJobAppTab) break;
    }
    
    if (!foundJobAppTab) {
        System.debug('  ‚Ä¢ Job Applications Tab: ‚ùå NOT FOUND');
    }
    
} catch (Exception e) {
    System.debug('‚ùå Tab Check Error: ' + e.getMessage());
}

// 7. Provide specific troubleshooting steps
System.debug('');
System.debug('üîß SPECIFIC TROUBLESHOOTING STEPS:');
System.debug('');

if (uiTheme != 'Theme4d') {
    System.debug('‚ùó CRITICAL ISSUE: You\'re not in Lightning Experience!');
    System.debug('üí° SOLUTION: Switch to Lightning Experience');
    System.debug('   1. Click your profile picture (top right)');
    System.debug('   2. Select "Switch to Lightning Experience"');
    System.debug('   3. Custom apps only work in Lightning!');
    System.debug('');
}

if (!hasJobAppManager) {
    System.debug('‚ùó ISSUE: Job Application Manager permission set not assigned');
    System.debug('üí° SOLUTION: Run this command:');
    System.debug('   sf org assign permset --name Job_Application_Manager');
    System.debug('');
}

System.debug('üéØ CUSTOM APP TROUBLESHOOTING CHECKLIST:');
System.debug('');
System.debug('1. ‚úÖ Check Lightning Experience (CRITICAL)');
System.debug('   ‚Ä¢ Must be in Lightning, not Classic');
System.debug('   ‚Ä¢ Custom apps don\'t work in Classic');
System.debug('');
System.debug('2. ‚úÖ Verify App Deployment');
System.debug('   ‚Ä¢ Go to Setup ‚Üí Apps ‚Üí App Manager');
System.debug('   ‚Ä¢ Look for "Job Application Tracker"');
System.debug('   ‚Ä¢ Should show as "Active"');
System.debug('');
System.debug('3. ‚úÖ Check Permission Assignment');
System.debug('   ‚Ä¢ Setup ‚Üí Permission Sets ‚Üí Job Application Manager');
System.debug('   ‚Ä¢ Check "Manage Assignments"');
System.debug('   ‚Ä¢ Your user should be listed');
System.debug('');
System.debug('4. ‚úÖ Clear Browser Cache');
System.debug('   ‚Ä¢ Ctrl+Shift+Delete (Windows)');
System.debug('   ‚Ä¢ Cmd+Shift+Delete (Mac)');
System.debug('   ‚Ä¢ Clear all Salesforce cookies');
System.debug('');
System.debug('5. ‚úÖ Try Incognito/Private Mode');
System.debug('   ‚Ä¢ Open new incognito window');
System.debug('   ‚Ä¢ Login to Salesforce');
System.debug('   ‚Ä¢ Check App Launcher');
System.debug('');

System.debug('üö® IMMEDIATE ACTIONS TO TRY:');
System.debug('1. Switch to Lightning Experience (if not already)');
System.debug('2. Clear browser cache completely');
System.debug('3. Log out and back in');
System.debug('4. Check Setup ‚Üí Apps ‚Üí App Manager');
System.debug('5. Try different browser');
System.debug('');

System.debug('üì± ALTERNATIVE ACCESS METHODS:');
System.debug('‚Ä¢ Direct URL: /lightning/app/c__Job_Application_Tracker');
System.debug('‚Ä¢ Setup ‚Üí Apps ‚Üí App Manager ‚Üí Job Application Tracker ‚Üí View');
System.debug('‚Ä¢ Global Search: Search for "Job Application Tracker"');
System.debug('');

System.debug('=== INVESTIGATION COMPLETE ===');
System.debug('Run the troubleshooting steps above based on the findings!');
