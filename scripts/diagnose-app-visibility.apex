// Comprehensive diagnosis of app visibility issues
System.debug('=== DIAGNOSING APP VISIBILITY ISSUES ===');

// 1. Check current user information
User currentUser = [SELECT Id, Name, Email, Profile.Name, UserRole.Name FROM User WHERE Id = :UserInfo.getUserId()];
System.debug('ğŸ‘¤ Current User: ' + currentUser.Name);
System.debug('ğŸ“§ Email: ' + currentUser.Email);
System.debug('ğŸ·ï¸ Profile: ' + currentUser.Profile.Name);
System.debug('ğŸ­ Role: ' + (currentUser.UserRole?.Name ?? 'No Role'));

// 2. Check permission set assignments
List<PermissionSetAssignment> permSets = [
    SELECT PermissionSet.Name, PermissionSet.Label 
    FROM PermissionSetAssignment 
    WHERE AssigneeId = :UserInfo.getUserId()
];
System.debug('ğŸ” Permission Sets Assigned: ' + permSets.size());
for (PermissionSetAssignment psa : permSets) {
    System.debug('  â€¢ ' + psa.PermissionSet.Label + ' (' + psa.PermissionSet.Name + ')');
}

// 3. Check if Job Application Manager permission set is assigned
Boolean hasJobAppManager = false;
for (PermissionSetAssignment psa : permSets) {
    if (psa.PermissionSet.Name == 'Job_Application_Manager') {
        hasJobAppManager = true;
        break;
    }
}
System.debug('âœ… Has Job Application Manager: ' + hasJobAppManager);

// 4. Check object access
try {
    Schema.DescribeSObjectResult jobAppDescribe = Job_Application__c.SObjectType.getDescribe();
    System.debug('ğŸ“Š Job Application Object Access:');
    System.debug('  â€¢ Accessible: ' + jobAppDescribe.isAccessible());
    System.debug('  â€¢ Createable: ' + jobAppDescribe.isCreateable());
    System.debug('  â€¢ Updateable: ' + jobAppDescribe.isUpdateable());
    System.debug('  â€¢ Deletable: ' + jobAppDescribe.isDeletable());
} catch (Exception e) {
    System.debug('âŒ Error accessing Job Application object: ' + e.getMessage());
}

// 5. Check tab visibility
try {
    List<Job_Application__c> testRecords = [SELECT Id, Name FROM Job_Application__c LIMIT 1];
    System.debug('ğŸ“‹ Can query Job Applications: âœ… (' + testRecords.size() + ' records found)');
} catch (Exception e) {
    System.debug('âŒ Cannot query Job Applications: ' + e.getMessage());
}

// 6. Check Lightning Experience
System.debug('âš¡ Lightning Experience Check:');
System.debug('  â€¢ User Interface: ' + (UserInfo.getUiThemeDisplayed() == 'Theme4d' ? 'Lightning' : 'Classic'));

// 7. Provide solutions
System.debug('');
System.debug('ğŸ”§ SOLUTIONS TO TRY:');
System.debug('');

if (!hasJobAppManager) {
    System.debug('â— ISSUE: Job Application Manager permission set not assigned');
    System.debug('ğŸ’¡ SOLUTION: Run this command:');
    System.debug('   sf org assign permset --name Job_Application_Manager');
    System.debug('');
}

System.debug('ğŸ¯ APP VISIBILITY CHECKLIST:');
System.debug('1. âœ… Deploy custom app: sf project deploy start --source-dir force-app/main/default');
System.debug('2. âœ… Assign permission set: sf org assign permset --name Job_Application_Manager');
System.debug('3. âœ… Refresh browser completely (Ctrl+F5)');
System.debug('4. âœ… Check App Launcher (9 dots) â†’ Search "Job Application Tracker"');
System.debug('5. âœ… If still not visible, check Setup â†’ Apps â†’ App Manager');
System.debug('');

System.debug('ğŸ” ALTERNATIVE ACCESS METHODS:');
System.debug('â€¢ Direct Tab: Look for "Job Applications" tab in any app');
System.debug('â€¢ Global Search: Search for "Job Application" in the search bar');
System.debug('â€¢ Setup: Setup â†’ Object Manager â†’ Job Application â†’ Tab');
System.debug('');

System.debug('ğŸ“± CUSTOM APP TROUBLESHOOTING:');
System.debug('â€¢ App may take 5-10 minutes to appear after deployment');
System.debug('â€¢ Try logging out and back in');
System.debug('â€¢ Clear browser cache and cookies');
System.debug('â€¢ Check if you\'re in Lightning Experience (not Classic)');
System.debug('');

System.debug('ğŸ‰ ONCE WORKING:');
System.debug('â€¢ App Launcher â†’ "Job Application Tracker"');
System.debug('â€¢ Should see all tabs: Home, Job Applications, Contacts, etc.');
System.debug('â€¢ Utility bar at bottom with Notes, History, Rich Text');
System.debug('');

System.debug('=== DIAGNOSIS COMPLETE ===');
